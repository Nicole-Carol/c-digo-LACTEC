
  #include "DHT.h"
#include <WiFi.h>
#include <HTTPClient.h>

#define DHTPIN 4          // pino de dados do DHT22
#define DHTTYPE DHT22
const int ledPin = 2;     // LED

DHT dht(DHTPIN, DHTTYPE);

// --- Intervalos de tempo ---
unsigned long previousMillisBlink = 0;
unsigned long previousMillisRead = 0;
const long blinkInterval = 500;
const long readInterval = 20000; // 20 segundos entre envios (ThingSpeak limita a cada 15s)

// --- Wi-Fi ---
const char* ssid = "Wokwi-GUEST";
const char* password = ""; // rede aberta no Wokwi (senha vazia)

// --- ThingSpeak ---
String apiKey = "IUCP87GFL6XJCUNL"; 
const char* server = "http://api.thingspeak.com/update";

void setup() {
  Serial.begin(115200);
  dht.begin();
  pinMode(ledPin, OUTPUT);

  Serial.print("Conectando ao Wi-Fi...");
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWi-Fi conectado!");
  Serial.print("Endereço IP: ");
  Serial.println(WiFi.localIP());
  Serial.println("Iniciando: LED + DHT22 + ThingSpeak");
}

void loop() {
  unsigned long now = millis();

  // Piscar LED
  if (now - previousMillisBlink >= blinkInterval) {
    previousMillisBlink = now;
    digitalWrite(ledPin, !digitalRead(ledPin));
  }

  // Ler e enviar dados a cada intervalo
  if (now - previousMillisRead >= readInterval) {
    previousMillisRead = now;
    float h = dht.readHumidity();
    float t = dht.readTemperature();

    if (isnan(h) || isnan(t)) {
      Serial.println("Falha ao ler DHT22!");
      return;
    }

    Serial.print("Umidade: ");
    Serial.print(h);
    Serial.print(" %\tTemperatura: ");
    Serial.print(t);
    Serial.println(" °C");

    if (WiFi.status() == WL_CONNECTED) {
      HTTPClient http;
      String url = server;
      url += "?api_key=" + apiKey + "&field1=" + String(t) + "&field2=" + String(h);

      http.begin(url);
      int httpCode = http.GET();

      if (httpCode > 0) {
        Serial.println("Dados enviados ao ThingSpeak!");
      } else {
        Serial.print("Erro ao enviar: ");
        Serial.println(httpCode);
      }

      http.end();
    } else {
      Serial.println("Wi-Fi desconectado!");
    }
  }
}


